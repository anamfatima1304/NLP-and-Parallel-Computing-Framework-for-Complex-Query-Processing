<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Query Execution Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/main.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Parallel Query Execution Dashboard</h1>
            <p class="subtitle">Natural Language Query Processing with Parallel Execution</p>
        </header>

        <!-- Dataset Information Panel -->
        <section class="panel dataset-panel">
            <h2>Dataset Overview</h2>
            <div class="dataset-stats">
                <div class="stat-item">
                    <span class="stat-label">Total Rows</span>
                    <span class="stat-value">{{ dataset_info.rows }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Columns</span>
                    <span class="stat-value">{{ dataset_info.columns }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Memory Usage</span>
                    <span class="stat-value">{{ dataset_info.memory_usage }}</span>
                </div>
            </div>
            
            <div class="dataset-columns">
                <h3>Available Columns</h3>
                <div class="column-list">
                    {% for col in dataset_info.column_names %}
                    <span class="column-tag">{{ col }}</span>
                    {% endfor %}
                </div>
            </div>

            <div class="dataset-preview">
                <h3>Data Preview</h3>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                {% for col in dataset_info.column_names[:8] %}
                                <th>{{ col }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in dataset_info.sample_data[:3] %}
                            <tr>
                                {% for col in dataset_info.column_names[:8] %}
                                <td>{{ row[col] }}</td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Query Input Panel -->
        <section class="panel query-panel">
            <h2>Query Execution</h2>
            
            <div class="query-input-group">
                <label for="query-input">Enter your query</label>
                <textarea id="query-input" rows="4" placeholder="Example: Show me total sales and average profit by region and category for year 2017 where sales greater than 5000"></textarea>
            </div>

            <div class="execution-controls">
                <div class="processor-selector">
                    <label for="processor-count">Number of Processors</label>
                    <div class="processor-options">
                        <button class="processor-btn active" data-processors="1">1</button>
                        <button class="processor-btn" data-processors="2">2</button>
                        <button class="processor-btn" data-processors="4">4</button>
                    </div>
                </div>

                <button id="execute-btn" class="execute-btn">Execute Query</button>
            </div>

            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <span>Processing query...</span>
            </div>
        </section>

        <!-- Query Analysis Panel -->
        <section id="analysis-panel" class="panel analysis-panel hidden">
            <h2>Query Analysis</h2>
            
            <div class="analysis-grid">
                <div class="analysis-item">
                    <h3>Filters Applied</h3>
                    <div id="filters-list" class="info-list"></div>
                </div>
                
                <div class="analysis-item">
                    <h3>Grouping Columns</h3>
                    <div id="groupings-list" class="info-list"></div>
                </div>
                
                <div class="analysis-item">
                    <h3>Aggregations</h3>
                    <div id="aggregations-list" class="info-list"></div>
                </div>
            </div>

            <div class="execution-info">
                <div class="info-row">
                    <span class="info-label">Total Tasks:</span>
                    <span id="total-tasks" class="info-value">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Execution Layers:</span>
                    <span id="total-layers" class="info-value">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Max Parallelism:</span>
                    <span id="max-parallelism" class="info-value">-</span>
                </div>
            </div>
        </section>

        <!-- Performance Panel -->
        <section id="performance-panel" class="panel performance-panel hidden">
            <h2>Performance Metrics</h2>
            
            <div class="performance-grid">
                <div class="metric-card">
                    <span class="metric-label">Execution Time</span>
                    <span id="exec-time" class="metric-value">-</span>
                </div>
                <div class="metric-card">
                    <span class="metric-label">Processors Used</span>
                    <span id="processors-used" class="metric-value">-</span>
                </div>
                <div class="metric-card">
                    <span class="metric-label">Tasks Executed</span>
                    <span id="tasks-executed" class="metric-value">-</span>
                </div>
                <div class="metric-card">
                    <span class="metric-label">Result Rows</span>
                    <span id="result-rows" class="metric-value">-</span>
                </div>
            </div>
        </section>

        <!-- Results Panel -->
        <section id="results-panel" class="panel results-panel hidden">
            <h2>Query Results</h2>
            <div id="results-container" class="results-container"></div>
        </section>

        <!-- Error Panel -->
        <section id="error-panel" class="panel error-panel hidden">
            <h2>Error</h2>
            <div id="error-message" class="error-message"></div>
        </section>
    </div>

    <script src="{{ url_for('static', filename='scripts/main.js') }}"></script>
</body>
</html>